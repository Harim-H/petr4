<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Petr4 | Web</title>

  <link rel="stylesheet" href="css/katex.min.css" />
  <link rel="stylesheet" href="css/all.css" />
  <link rel="stylesheet" href="css/bootstrap.min.css" />

  <link rel="stylesheet" href="css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="css/syntax.css" />
  <link rel="stylesheet" href="css/codeblock.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">
  <link rel="stylesheet" href="css/editor.css" />
  <style>
    font-family: 'Lora', 'Times New Roman', serif;
    font-size: 12pt;
  </style>
</head>
<body style="padding-top:100px;">

  <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="">Petr4: Formal Foundations for P4</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        <li>
              <a title="Demo">Demo</a>
            </li>
            <li>
              <a title="Code" href="https://github.com/cornell-netlab/petr4">Code</a>
            </li>
            <li>
              <a title="Paper" href="petr4-draft.pdf">Draft Paper</a>
            </li>
      </ul>
    </div>
    
    <div class="avatar-container">
      <div class="avatar-img-border">
        <a title="Petr4" href="/">
          <img class="avatar-img" src="petr4-logo.png" alt="Petr4" />
        </a>
      </div>
    </div>
  </div>
</nav>

<div role="main" class="container">
    <div class="row">
      <div class="col-lg-10">
        <h3>P4 Program</h3>
        <div id="code-area" style="opacity:0">
      
#include &lt;core.p4&gt;
#include &lt;v1model.p4&gt;

typedef standard_metadata_t std_meta_t;

header h_t { 
  bit<8> x;
  bit<8> y; 
}
struct H { 
  h_t h;
}

struct M { }

parser MyParser(packet_in pkt, out H hdr, inout M meta, inout std_meta_t std_meta) {
    state start {
        pkt.extract(hdr.h);
        transition accept;
    }
}

control MyVerifyChecksum(inout H hdr, inout M meta) {
    apply { }
}

control MyComputeChecksum(inout H hdr, inout M meta) {
    apply { }
}

control MyIngress(inout H hdr, inout M meta, inout std_meta_t std_meta) {
  apply {
    hdr.h.x = 0xFF;
    hdr.h.y = 0x00;
    std_meta.egress_spec = 9;
  }
}

control MyEgress(inout H hdr, inout M meta, inout std_meta_t std_meta) {
    apply { }
}

control MyDeparser(packet_out buf, in H hdr) {
    apply {
        buf.emit(hdr.h);
    }
}

V1Switch(MyParser(), MyVerifyChecksum(), MyIngress(), MyEgress(), MyComputeChecksum(), MyDeparser()) main;
        </div>
      </div>
    </div>
    <div class="row"></div>
    <div class="row">
      <div style="display:none;" id="control-json-area" style="opacity:0">
        { "matches": [ ] }
      </div>
    </div>
    <div class="row">
      <div class="col-lg-3">
        <h3>Input Packet</h3>
        <textarea rows="2" cols="50" id="packet-in" style="font-family: 'Consolas'; font-size:10pt;" spellcheck="false">01 01 01 01</textarea>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-3">
        <h3>Output</h3>
        <textarea rows="2" cols="50" id="packet-out" style="font-family: 'Consolas'; font-size:10pt;" readonly></textarea></br/>
        <button id="evaluate" class="btn btn-primary">Evaluate!</button>
      </div>
    </div>
</div>

<script src="https://pagecdn.io/lib/ace/1.4.8/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="web.bc.js"></script>
<script>

    //ace.config.set("workerPath", "build/src-min");
    var p4_editor = ace.edit("code-area");
    var control_editor = ace.edit("control-json-area");

    control_editor.container.style.opacity = "";
    control_editor.setFontSize("12px");
    control_editor.setOptions({
        maxLines: 40,
        mode: "ace/mode/json",
        autoScrollEditorIntoView: true
    });
    p4_editor.setTheme("ace/theme/xcode");
    p4_editor.container.style.opacity = "";
    p4_editor.setFontSize("12px");
    p4_editor.setShowPrintMargin(false);
    p4_editor.setOptions({
        maxLines: 40,
        mode: "ace/mode/c_cpp",
        autoScrollEditorIntoView: true
    });
    const button = document.getElementById("evaluate")
    var in_area = document.getElementById("packet-in")
    var out_area = document.getElementById("packet-out")
    button.onclick = function () {
        out_area.value = Petr4.eval(in_area.value, control_editor.getValue(), p4_editor.getValue());
    }
    </script>
</body>
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans" />
</html>
