<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Petr4</title>
  <style>
      .button {
  background-color: #5bc0de;
  border: none;
  color: white;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
}
    .grid-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 2fr 1fr;
      width: 95vw;
        height: 90vh;
    }
    .grid-item {
        margin: auto;
        height: 100%;
        width: 100%;
        align-items: center;
    }
    textarea {
    box-sizing: border-box; /* fit parent width */
    height: 70%;
    width: 100%;
    font-family: monospace;
    }
    label {
    width: 100%;
    display:inline-block;
    text-align: center;
    }
    </style>
</head>
<body>
<div class="grid-container">
    <div class = "grid-item" ><label><h3>p4 program</h3></label><div id ="code-area" style="opacity:0">

        #include &lt;core.p4&gt;
            #include &lt;v1model.p4&gt;

            struct metadata { }
            struct headers { }

            parser MyParser(packet_in packet,
                            out headers hdr,
                            inout metadata meta,
                            inout standard_metadata_t standard_metadata) {
                state start {
                    transition accept;
                }
            }

            control MyChecksum(inout headers hdr, inout metadata meta) {
                apply { }
            }

            control MyIngress(inout headers hdr,
                              inout metadata meta,
                              inout standard_metadata_t standard_metadata) {
                apply {
                    standard_metadata.egress_spec = 9;
                }
            }

            control MyEgress(inout headers hdr,
                             inout metadata meta,
                             inout standard_metadata_t standard_metadata) {
                apply { }
            }

            control MyDeparser(packet_out packet, in headers hdr) {
                apply { }
            }

            //this is declaration
            V1Switch(
                MyParser(),
                MyChecksum(),
                MyIngress(),
                MyEgress(),
                MyChecksum(),
                MyDeparser()
                )
            main;


    </div></div>
    <div class = "grid-item"><label><h3>control</h3></label><div id="control-json-area" style="opacity:0">
        {
            "pre_entries": [
                {
                "annotations": [],
                "matches": [
                    [
                    [
                        "info",
                        {
                        "filename": "./examples/eval_tests/controls/table.p4\"",
                        "line_start": 44,
                        "line_end": null,
                        "col_start": 12,
                        "col_end": 15
                        }
                    ],
                    [
                        "Expression",
                        {
                        "expr": [
                            [
                            "info",
                            {
                                "filename": "./examples/eval_tests/controls/table.p4\"",
                                "line_start": 44,
                                "line_end": null,
                                "col_start": 12,
                                "col_end": 15
                            }
                            ],
                            [
                            "int",
                            [
                                [
                                "info",
                                {
                                    "filename": "./examples/eval_tests/controls/table.p4\"",
                                    "line_start": 44,
                                    "line_end": null,
                                    "col_start": 12,
                                    "col_end": 15
                                }
                                ],
                                {
                                "value": 0,
                                "width_signed": [
                                    9,
                                    false
                                ]
                                }
                            ]
                            ]
                        ]
                        }
                    ]
                    ]
                ],
                "action": [
                    [
                    "info",
                    {
                        "filename": "./examples/eval_tests/controls/table.p4\"",
                        "line_start": 44,
                        "line_end": null,
                        "col_start": 18,
                        "col_end": 25
                    }
                    ],
                    {
                    "annotations": [],
                    "name": [
                        [
                        "info",
                        {
                            "filename": "./examples/eval_tests/controls/table.p4\"",
                            "line_start": 44,
                            "line_end": null,
                            "col_start": 18,
                            "col_end": 25
                        }
                        ],
                        "set_one"
                    ],
                    "args": []
                    }
                ]
                }
            ],
            "matches": [
                [
                    [
                    [
                        "info",
                        {
                        "filename": "./examples/eval_tests/parsers/value_set.p4\"",
                        "line_start": 23,
                        "line_end": null,
                        "col_start": 12,
                        "col_end": 14
                        }
                    ],
                    [
                        "Expression",
                        {
                        "expr": [
                            [
                            "info",
                            {
                                "filename": "./examples/eval_tests/parsers/value_set.p4\"",
                                "line_start": 23,
                                "line_end": null,
                                "col_start": 12,
                                "col_end": 14
                            }
                            ],
                            [
                            "int",
                            [
                                [
                                "info",
                                {
                                    "filename":
                                    "./examples/eval_tests/parsers/value_set.p4\"",
                                    "line_start": 23,
                                    "line_end": null,
                                    "col_start": 12,
                                    "col_end": 14
                                }
                                ],
                                { "value": 42, "width_signed": null }
                            ]
                            ]
                        ]
                        }
                    ]
                    ]
                ]
                ]
            }
        </div></div>
    <div class = "grid-item"><label><h3>packet in</h3></label><textarea rows="4" cols="50" id="packet-area" spellcheck="false">2A2A2A2A2A2A2A2A2A2A2A2A21</textarea></div>
    <div class = "grid-item"><label><h3>packet out</h3></label><textarea rows="4" cols="50" id="output" readonly>out</textarea></div>
  </div>



  <button id="form-submit" class = "button">run</button>


  <script src="https://pagecdn.io/lib/ace/1.4.8/ace.js" type="text/javascript" charset="utf-8"></script>
  <script src="web.bc.js"></script>
<script>

    //ace.config.set("workerPath", "build/src-min");
    var p4_editor = ace.edit("code-area");
    var control_editor = ace.edit("control-json-area");

    control_editor.container.style.opacity = "";
    control_editor.setFontSize("14px");
    control_editor.setOptions({
        maxLines: 40,
        mode: "ace/mode/json",
        autoScrollEditorIntoView: true
    });
    p4_editor.container.style.opacity = "";
    p4_editor.setFontSize("14px");
    p4_editor.setOptions({
        maxLines: 40,
        mode: "ace/mode/c_cpp",
        autoScrollEditorIntoView: true
    });
    const button = document.getElementById("form-submit")
    var in_area = document.getElementById("packet-area")
    var out_area = document.getElementById("output")
    button.onclick = function () {
        out_area.value = Petr4.eval(in_area.value, control_editor.getValue(), p4_editor.getValue());
    }
    </script>
</body>
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans" />
</html>
